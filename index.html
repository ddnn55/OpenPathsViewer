<!DOCTYPE html>
<meta charset="utf-8">
<title>Reprojected Raster Tiles</title>
<style>
@import url(../maps.css);

#map {
  position: relative;
  margin: 0 auto;
  overflow: hidden;
}

.tile {
  position: absolute;
}
</style>

<div id="map"></div>


<script src="d3.v3.min.js"></script>
<script src="d3.geo.projection.min.js"></script>
<script src="topojson.min.js"></script>
<script src="d3.quadtiles.js"></script>
<script src="d3.geo.raster.js"></script>
<script>

var ratio = 1,
    width = 960 * ratio,
    height = 600 * ratio,
    p = .5;

var projection = d3.geo.albers()
    .rotate([0, 0])
    .center([0, 52])
    .scale(150 * ratio)
    .translate([width / 2, height / 2])
    .clipExtent([[p, p], [width - p, height - p]]);

var raster = d3.geo.raster(projection)
    .url("http://api.tiles.mapbox.com/v3/examples.map-zr0njcqy/{z}/{x}/{y}.png32");

var layer = d3.select("#map")
    .style("width", width / ratio + "px")
    .style("height", height / ratio + "px")
    .call(d3.behavior.zoom()
      .translate([.5 * width / ratio, .5 * height / ratio])
      .scale(projection.scale() / ratio)
      .scaleExtent([1e2, 1e8])
      .on("zoom", function() {
        var t = d3.event.translate,
            s = d3.event.scale;
        projection.translate([t[0] * ratio, t[1] * ratio]).scale(s * ratio);
        layer.call(raster);
      }))
  .append("div")
    .style(prefix + "transform-origin", "0 0 0")
  .append("div")
    .style(prefix + "transform-origin", "0 0 0")
    .call(raster);

</script>
